<!doctype html>
<html lang="ar" dir="rtl">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>إضافة عقار</title>
<link rel="stylesheet" href="styles.css"/></head>
<body>
<div class="container">
  <h2>أضف عقار</h2>
  <div class="card">
    <input id="title" placeholder="عنوان العقار"/><input id="price" placeholder="السعر"/>
    <input id="location" placeholder="المدينة"/><input id="neighborhood" placeholder="الحي"/>
    <textarea id="description" placeholder="وصف العقار"></textarea>
    <input id="media" type="file" accept="image/*,video/*"/>
    <button onclick="submitListing()" class="button">أرسل للإدارة</button>
    <div id="msg" class="small"></div>
  </div>
</div>
<script>
async function submitListing(){
  const token = localStorage.getItem('token');
  if(!token){ location.href='register.html'; return; }
  const title = document.getElementById('title').value.trim();
  const price = document.getElementById('price').value.trim();
  if(!title || !price){ alert('اكمل الحقول'); return; }
  const description = document.getElementById('description').value.trim();
  const file = document.getElementById('media').files[0];
  let mediaData = '';
  if(file){
    mediaData = await new Promise((res,rej)=>{
      const r = new FileReader();
      r.onload = ()=> res(r.result);
      r.onerror = ()=> rej('fail');
      r.readAsDataURL(file);
    });
  }
  const payload = { title, price, location:document.getElementById('location').value, neighborhood:document.getElementById('neighborhood').value, description, image: mediaData, approved: false };
  const res = await fetch('/api/properties',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(payload)});
  if(res.ok){ document.getElementById('msg').innerText='تم إرسال العقار للمراجعة'; setTimeout(()=>location.href='index.html',1200); } else { document.getElementById('msg').innerText='خطأ في الإرسال'; }
}
</script>
</body>
</html>